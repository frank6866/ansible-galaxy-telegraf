Telegraf
========

This role is used to deploy Telegraf. Support features as foolows:

* output to InfluxDB with auth or https
* enable ceph monitor
* enable mysql monitor
* eanble docker monitor


Prepare
-------
If your InfluxDB enable https, you should first get cert releated files.

inventory file example
----------------------

```
# Generated by Vagrant

vagrant1 ansible_ssh_host=192.168.168.202 ansible_ssh_port=2222 ansible_ssh_user='vagrant'

[telegraf]
vagrant1

[ceph]
vagrant1

[mysql]
vagrant1

[docker]
vagrant1

[telegraf:vars]
telegraf_influxdb_api_url=https://192.168.168.201:8086

telegraf_influxdb_use_auth=true
telegraf_influxdb_username=frank6866
telegraf_influxdb_password=change_me

telegraf_influxdb_use_https=true
telegraf_influxdb_cert_file_path=/tmp/process_csr/influxdb/influxdb.crt
telegraf_influxdb_key_file_path=/tmp/process_csr/influxdb/influxdb.key
telegraf_influxdb_cacert_file_path=/usr/local/etc/openssl/myCA/cacert.pem


```

Notice that the cert releated files' path is local path, aka, on you computer, not on the server.



Role Variables
--------------
If InfluxDB is started with auth, you can set **telegraf_influxdb_use_auth** to "true", and set the following variable:

```
telegraf_influxdb_username=frank6866
telegraf_influxdb_password=change_me
```


If InfluxDB is started with https, you should set **telegraf_influxdb_use_https** variable to "true", and set the following variable:

```
telegraf_influxdb_cert_file_path=/tmp/process_csr/influxdb/influxdb.crt
telegraf_influxdb_key_file_path=/tmp/process_csr/influxdb/influxdb.key
telegraf_influxdb_cacert_file_path=/usr/local/etc/openssl/myCA/cacert.pem
```

Notice that the cert releated files' path is local path, aka, on you computer, not on the server.


If you want to enable ceph monitor for some hosts, you can put these hosts in a host group in inventory file, eg:

```
[ceph]
vagrant1
```



Example Playbook
----------------

```
- hosts: telegraf
  become: true
  roles:
    - frank6866.telegraf
```

License
-------

MIT
